-- auction-starter-tables.sql -- SQL table definitions
-- Auction Web Application Project
--
-- C S 105: PHP/SQL, Fall 2014, J. Thywissen
-- The University of Texas at Austin
--

-- - - - - - - - -
-- Create tables
-- - - - - - - - -
DROP TABLE IF EXISTS AUCTION, PERSON, AUCTION_STATUS, ITEM_CATEGORY;

CREATE TABLE PERSON (
    PERSON_ID INTEGER PRIMARY KEY,
    SURNAME VARCHAR(96) NOT NULL,
    FORENAME VARCHAR(96),
    EMAIL_ADDRESS VARCHAR(255) NOT NULL,
    PASSWORD VARCHAR (255) NOT NULL);

CREATE TABLE AUCTION_STATUS (
    AUCTION_STATUS_ID INTEGER PRIMARY KEY,
    NAME VARCHAR(20) NOT NULL );

CREATE TABLE ITEM_CATEGORY (
    ITEM_CATEGORY_ID INTEGER PRIMARY KEY,
    NAME VARCHAR(78) NOT NULL );

CREATE TABLE AUCTION (
    AUCTION_ID INTEGER PRIMARY KEY,
    HIGHEST_BIDDER INTEGER,
    NUM_BID INTEGER NOT NULL,
    STATUS INTEGER NOT NULL,
    SELLER INTEGER NOT NULL,
    START_PRICE INTEGER NOT NULL,
    CURRENT_PRICE INTEGER NOT NULL,
    OPEN_TIME TIMESTAMP,
    CLOSE_TIME TIMESTAMP,
    ITEM_CATEGORY INTEGER,
    ITEM_CAPTION VARCHAR(78),
    ITEM_DESCRIPTION VARCHAR(998),
    ITEM_PHOTO MEDIUMBLOB );

CREATE TABLE BID (
    AUCTION_ID INTEGER NOT NULL,
    PERSON_ID INTEGER NOT NULL
);


CREATE INDEX AUCTION_STATUS_INDEX ON AUCTION (STATUS);

CREATE INDEX AUCTION_SELLER_INDEX ON AUCTION (SELLER);

CREATE INDEX AUCTION_ITEM_CATEGORY_INDEX ON AUCTION (ITEM_CATEGORY);

ALTER TABLE AUCTION ADD FOREIGN KEY (STATUS) REFERENCES AUCTION_STATUS(AUCTION_STATUS_ID);

ALTER TABLE AUCTION ADD FOREIGN KEY (SELLER) REFERENCES PERSON(PERSON_ID);

ALTER TABLE AUCTION ADD FOREIGN KEY (ITEM_CATEGORY) REFERENCES ITEM_CATEGORY(ITEM_CATEGORY_ID);

ALTER TABLE BID ADD FOREIGN KEY(AUCTION_ID) REFERENCES AUCTION(AUCTION_ID);

ALTER TABLE BID ADD FOREIGN KEY(PERSON_ID) REFERENCES PERSON(PERSON_ID);



-- - - - - - - - -
-- Insert sample data
-- - - - - - - - -

INSERT INTO PERSON VALUES (1, 'Dent', 'Arthur', 'a.dent@example.com', 'aaaa');
INSERT INTO PERSON VALUES (2, 'McMillan', 'Tricia', 'trillian@example.com', 'bbbb');
INSERT INTO PERSON VALUES (3, 'Prefect', 'Ford', 'ix@example.com', 'ccccc');
INSERT INTO PERSON VALUES (4, 'Somebody', 'Someone', 'me@example.com', 'ddddd');

INSERT INTO AUCTION_STATUS VALUES (1, 'Open');
INSERT INTO AUCTION_STATUS VALUES (2, 'Cancelled');
INSERT INTO AUCTION_STATUS VALUES (3, 'Won');
INSERT INTO AUCTION_STATUS VALUES (4, 'Failed');
INSERT INTO AUCTION_STATUS VALUES (5, 'Pending');
INSERT INTO AUCTION_STATUS VALUES (6, 'Sold');

INSERT INTO ITEM_CATEGORY VALUES (1, 'Antiques');
INSERT INTO ITEM_CATEGORY VALUES (2, 'Art & Collectibles');
INSERT INTO ITEM_CATEGORY VALUES (3, 'Books & Movies & Music');
INSERT INTO ITEM_CATEGORY VALUES (4, 'Cars');
INSERT INTO ITEM_CATEGORY VALUES (5, 'Clothing');
INSERT INTO ITEM_CATEGORY VALUES (6, 'Computers & Electronics');
INSERT INTO ITEM_CATEGORY VALUES (7, 'Jewelry');
INSERT INTO ITEM_CATEGORY VALUES (8, 'Musical Instruments');
INSERT INTO ITEM_CATEGORY VALUES (9, 'Tools');
INSERT INTO ITEM_CATEGORY VALUES (10, 'Toys');

INSERT INTO AUCTION VALUES (1, -1, 2, 1, 1, 1000, 1001, '2014-09-21 15:37:00', '2017-10-05 23:00:00', 5, 'Towels', 'Slightly used towels, set of 42', NULL);
INSERT INTO AUCTION VALUES (2, 1, 3, 1, 1, 1021, 30000, '2014-09-21 17:05:00', '2017-10-05 23:00:00', 3, '"My Favourite Bathtime Gurgles" by Grunthos the Flatulent', 'Grunthos'' 12-book epic.  Not to be missed.  Was to be presented at Mid-Galactic Arts Nobbling Council, but the poet''s death prevented its presentation.', NULL);
INSERT INTO AUCTION VALUES (3, 2, 100, 1, 2, 20, 25, '2014-09-21 17:06:00', '2017-10-05 23:00:00', 9, 'Toasting knife', 'Bread knife that toasts the bread as you cut it.', NULL);
INSERT INTO AUCTION VALUES (4, -1, 3, 6, 3, 50, 150, '2014-09-21 17:06:30', '2017-10-05 23:00:30', 6, 'King Size Bed', 'Extra bed, never used before', NULL);
INSERT INTO AUCTION VALUES (5, 3, 10, 5, 4, 20, 25, '2015-09-29 17:06:30', '2017-10-05 23:00:30', 7, 'Photo Frame', 'Handmade photo frame, really beautiful', NULL);
INSERT INTO AUCTION VALUES (6, 1, 10, 3, 4, 10, 11, '2015-09-30 17:06:30', '2017-10-05 23:00:30', 7, 'iphone used', 'still functional but broken', NULL);

